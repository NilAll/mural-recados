<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: #eee; padding-bottom: 100px; }
        
        .hero { width: 100%; height: 200px; object-fit: cover; background: #333; }
        .container { padding: 20px; max-width: 600px; margin: -30px auto 0; position: relative; }
        
        .info-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-size: 24px; color: #222; }
        .sub-info { color: #666; margin-top: 5px; }

        /* Card√°pio */
        .menu-section { margin-top: 20px; }
        .menu-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #444; border-left: 4px solid #ffc107; padding-left: 10px; }
        
        .menu-item { background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .menu-info h4 { margin: 0; font-size: 16px; }
        .menu-info p { margin: 0; color: #777; font-size: 12px; }
        .price { color: #28a745; font-weight: bold; margin-top: 5px; display: block; }

        .btn-add { background: #28a745; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 18px; cursor: pointer; }
        
        /* Barra Carrinho */
        .cart-bar { 
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: white; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none; justify-content: space-between; align-items: center; z-index: 100;
        }
        .btn-finalizar { background: #25D366; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; font-size: 16px; cursor: pointer; text-decoration: none; }
    </style>
</head>
<body>

    <a href="index.html" style="position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.5); color: white; padding: 5px 15px; border-radius: 20px; text-decoration: none; font-weight: bold;">‚¨Ö Voltar</a>
    <img id="capa" class="hero" src="">
    
    <div class="container">
        <div class="info-card">
            <h1 id="nome">...</h1>
            <p class="sub-info" id="cats">...</p>
            <p class="sub-info" id="endereco">...</p>
        </div>

        <div id="area-cardapio" class="menu-section" style="display: none;">
            <div class="menu-title">üõµ Card√°pio / Delivery</div>
            <div id="lista-produtos"></div>
        </div>
    </div>

    <div id="cartBar" class="cart-bar">
        <div>
            <small>Total do Pedido:</small><br>
            <strong id="totalValor" style="font-size: 18px;">R$ 0,00</strong>
        </div>
        <button id="btnZap" class="btn-finalizar">Enviar Pedido WhatsApp</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- SUAS CHAVES J√Å PREENCHIDAS ---
        const firebaseConfig = {
          apiKey: "AIzaSyDsTWnP2cmsUIDeDlotoR1uELMAba_-dyw",
          authDomain: "testegithub-e1ffb.firebaseapp.com",
          projectId: "testegithub-e1ffb",
          storageBucket: "testegithub-e1ffb.firebasestorage.app",
          messagingSenderId: "508103458559",
          appId: "1:508103458559:web:55bc2fe4dc61d7b5ee16ca"
        };
        // ----------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        let localData = null;
        let carrinho = [];

        async function carregarDetalhes() {
            if(!id) return window.location.href = "index.html";
            
            const docRef = doc(db, "guia_cidades", id);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                localData = docSnap.data();
                
                document.title = localData.nome;
                document.getElementById('nome').textContent = localData.nome;
                document.getElementById('cats').textContent = `${localData.categoria} > ${localData.subcategoria || ''}`;
                document.getElementById('endereco').textContent = `üìç ${localData.cidade}`;
                document.getElementById('capa').src = localData.imagem || "https://via.placeholder.com/400x200";

                if(localData.temDelivery && localData.cardapio) {
                    document.getElementById('area-cardapio').style.display = 'block';
                    const lista = document.getElementById('lista-produtos');
                    
                    localData.cardapio.forEach((item, index) => {
                        lista.innerHTML += `
                            <div class="menu-item">
                                <div class="menu-info">
                                    <h4>${item.nome}</h4>
                                    <p>${item.desc || ''}</p>
                                    <span class="price">R$ ${parseFloat(item.preco).toFixed(2)}</span>
                                </div>
                                <button class="btn-add" onclick="addCarrinho(${index})">+</button>
                            </div>`;
                    });
                }
            }
        }

        window.addCarrinho = (index) => {
            const item = localData.cardapio[index];
            carrinho.push(item);
            atualizarBarra();
        }

        function atualizarBarra() {
            const bar = document.getElementById('cartBar');
            if(carrinho.length > 0) {
                bar.style.display = 'flex';
                const total = carrinho.reduce((acc, item) => acc + parseFloat(item.preco), 0);
                document.getElementById('totalValor').textContent = `R$ ${total.toFixed(2)}`;
            }
        }

        document.getElementById('btnZap').addEventListener('click', () => {
            if(carrinho.length === 0) return;
            
            let msg = `Ol√° *${localData.nome}*, gostaria de fazer um pedido:\n\n`;
            carrinho.forEach(item => {
                msg += `‚ñ™ 1x ${item.nome} (R$ ${item.preco})\n`;
            });
            
            const total = carrinho.reduce((acc, item) => acc + parseFloat(item.preco), 0);
            msg += `\n*TOTAL: R$ ${total.toFixed(2)}*`;
            msg += `\n\nEndere√ßo de entrega: (Digitar)`;

            const num = localData.contato.replace(/\D/g,'');
            window.open(`https://wa.me/55${num}?text=${encodeURIComponent(msg)}`, '_blank');
        });

        carregarDetalhes();
    </script>
</body>
</html>