<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia da Cidade</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        
        body {
            background-color: #222; 
            background-size: cover; background-position: center; background-attachment: fixed;
            min-height: 100vh; color: white; padding: 20px 0;
            display: flex; flex-direction: column; align-items: center;
        }

        /* T√çTULO LIMPO COM SOMBRA */
        h1 { 
            margin-top: 15vh; 
            text-align: center;
            font-weight: bold;
            font-size: 2.5em;
            background: none; 
            text-transform: none; 
            text-shadow: 2px 2px 4px #000000;
        }

        .search-box { width: 90%; max-width: 500px; margin-top: 20px; margin-bottom: 20px; }
        input { width: 100%; padding: 15px 20px; font-size: 18px; border-radius: 30px; border: none; outline: none; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }

        #resultados { width: 90%; max-width: 500px; padding-bottom: 50px; }

        .card {
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 12px; overflow: hidden; margin-bottom: 15px;
            color: #333; display: flex; align-items: center; padding: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); position: relative; cursor: pointer;
        }
        
        .card-img { width: 70px; height: 70px; object-fit: cover; border-radius: 8px; margin-right: 15px; background: #ddd; }
        .card-content h3 { margin: 0 0 5px 0; font-size: 18px; color: #222; }
        .tag { background: #e0e0e0; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: #555; }
        .badge-delivery { background: #ffc107; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: #000; margin-left: 5px; }
    </style>
</head>
<body>

    <h1 id="appTitulo">Carregando...</h1>

    <div class="search-box">
        <input type="text" id="busca" placeholder="üîç Buscar..." autocomplete="off">
    </div>

    <div id="resultados"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, getDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- SUAS CHAVES J√Å PREENCHIDAS ---
        const firebaseConfig = {
          apiKey: "AIzaSyDsTWnP2cmsUIDeDlotoR1uELMAba_-dyw",
          authDomain: "testegithub-e1ffb.firebaseapp.com",
          projectId: "testegithub-e1ffb",
          storageBucket: "testegithub-e1ffb.firebasestorage.app",
          messagingSenderId: "508103458559",
          appId: "1:508103458559:web:55bc2fe4dc61d7b5ee16ca"
        };
        // ----------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function carregarTema() {
            try {
                const docSnap = await getDoc(doc(db, "config", "geral"));
                if (docSnap.exists()) {
                    const dados = docSnap.data();
                    if(dados.titulo) document.getElementById('appTitulo').textContent = dados.titulo;
                    if(dados.fundo) document.body.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('${dados.fundo}')`;
                }
            } catch(e) {}
        }
        carregarTema();

        let todosLocais = [];
        async function carregarDados() {
            const q = query(collection(db, "guia_cidades"), orderBy("nome"));
            const snapshot = await getDocs(q);
            todosLocais = [];
            snapshot.forEach(doc => todosLocais.push({ id: doc.id, ...doc.data() }));
        }

        const divResultados = document.getElementById('resultados');
        document.getElementById('busca').addEventListener('keyup', (e) => {
            const termo = e.target.value.toLowerCase();
            divResultados.innerHTML = "";
            if(termo.length < 1) return;

            // Busca agora inclui subcategoria
            const filtrados = todosLocais.filter(l => 
                l.nomeBusca.includes(termo) || 
                l.categoria.toLowerCase().includes(termo) ||
                (l.subcategoria && l.subcategoria.toLowerCase().includes(termo))
            );

            filtrados.forEach(local => {
                const imagem = local.imagem || "https://via.placeholder.com/150";
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <img src="${imagem}" class="card-img">
                    <div class="card-content">
                        <h3>${local.nome}</h3>
                        <span class="tag">${local.categoria}</span>
                        ${local.subcategoria ? `<span class="tag">${local.subcategoria}</span>` : ''}
                        ${local.temDelivery ? '<span class="badge-delivery">üõµ Delivery</span>' : ''}
                        <p>${local.cidade}</p>
                    </div>
                `;
                div.addEventListener('click', () => window.location.href = `detalhes.html?id=${local.id}`);
                divResultados.appendChild(div);
            });
        });
        carregar